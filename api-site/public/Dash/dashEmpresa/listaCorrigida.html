<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cadastro Empresa</title>

    <link rel="icon" href="../../IMG/Eagle Totens logo aguia sem fundo branco amarelo.png">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../dist/css/adminlte.min.css">
    <!-- DataTables -->
    <!-- Theme style -->
    <link rel="stylesheet" href="../dist/css/adminlte.min.css">
    <link rel="stylesheet" href="../dashSuporte/CSS/visaogeral.css">
    <link rel="stylesheet" href="../dashSuporte/CSS/visao.css">
    <link rel="stylesheet" href="../dashGerente/css/todosColaboradores.css">

    <!-- <link rel="stylesheet" href="cadastroEmpresa.css"> -->
</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">

        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__wobble" src="../../IMG/Eagle Totens logo aguia sem fundo branco amarelo.png" alt="" width="400">
        </div>
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="./index_suport.html" class="nav-link">Home</a>
                </li>

            </ul>


        </nav>
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a class="brand-link">
                <img src="../../IMG/Eagle Totens logo aguia sem fundo branco amarelo.png" alt=" Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">Eagle Totens</span>

            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <!-- <div class="image">
                        <img src="../../IMG/perfil-brenda.png" class="img-circle elevation-2" alt="User Image">
                    </div> -->
                    <div class="info">
                        <h5 style="color:white;">Olá, <span style="color: fff;" id="b_usuario">usuário</span>!
                        </h5>
                    </div>
                </div>




                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
                        <li class="nav-item">
                            <a href="../dashGerente/indexGerente.html" class="nav-link">
                                <i class="fa-solid fa-house"></i>
                                <p style="font-size:larger;">Dashboard - Visão Geral</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="../widgets.html" class="nav-link">
                                <i class="fas fa-user-plus"></i>
                                <p>
                                    Empresa
                                    <i class="fas fa-angle-left right"></i>

                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="listaEmpresa.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p> Todas as empresas</p>

                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="cadastroEmpresa.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p>Cadastrar empresa</p>
                                    </a>
                                </li>
                            </ul>
                            <a href="../widgets.html" class="nav-link">
                                <i class="fas fa-user-plus"></i>
                                <p>
                                    Colaborador
                                    <i class="fas fa-angle-left right"></i>

                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="../dashGerente/listaColaboradores.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p> Todos os colaboradores</p>

                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="../dashGerente/cadastroColaborador.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p>Cadastrar colaborador</p>
                                    </a>
                                </li>
                            </ul>

                            <a href="../widgets.html" class="nav-link">
                                <i class="fas fa-user-plus"></i>
                                <p>
                                    Totem
                                    <i class="fas fa-angle-left right"></i>

                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item">
                                    <a href="../dashSuporte/visaoGeralTotens.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p> Todos os totens</p>

                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="../dashSuporte/cadastrarTotem.html" class="nav-link">
                                        <i class="nav-icon far fa-circle "></i>
                                        <p>Cadastrar totem</p>
                                    </a>
                                </li>
                            </ul>

                            <li class="nav-item">
                                <a href="../../index.html" class="nav-link">
                                    <i class="nav-icon far fa-circle "></i>
                                    <p>Sair</p>
                                </a>
                            </li>

                    </ul>



                </nav>

                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">

                    <!-- /.row -->
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- /.content-header -->

            <!-- Main content -->
            <div class="content-header">
                <div class="container-fluid">

                    <!-- /.row -->
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- /.content-header -->

            <!-- Main content -->
            <style>
                .modal-content {
                    background-color: #3a3a3a !important;
                }
                
                label {
                    color: #ffe611 !important;
                }
                
                .form-control {
                    border-radius: 1rem !important;
                    background-color: #bcbcbc !important;
                }
                
                .form-control:focus {
                    border-color: #f1ff80 !important;
                    box-shadow: 0px 0px 20px -0.2rem rgb(238, 255, 0) !important;
                }
                
                .btn-default {
                    border-radius: 1rem !important;
                }
                
                .btn-default:focus {
                    box-shadow: 0px 0px 20px -0.2rem rgb(238, 255, 0) !important;
                    background-color: #5a5a5a !important;
                }
                
                .btn-save {
                    background-color: #ffe602 !important;
                    /* color: aliceblue !important; */
                }
                
                .modal-header .close {
                    margin: 0 !important;
                    padding: 0 1rem;
                }
            </style>
            <div class="box-body">
                <table id="tbEmpresa" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <!-- <th></th> -->
                            <th>Razão Social</th>
                            <th>CNPJ</th>
                            <th>Telefone</th>
                            <th>Lougradouro</th>
                            <th>N°</th>
                            <th>UF</th>
                            <th>Cidade</th>
                            <th>Actios</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr></tr>

                        <!-- <tr>
                            <td>Brenda</td>
                            <td>11949940145</td>
                            <td>Gerente</td>
                            <td>Brendarobertars48@gmail.com</td>
                            <td>*****</td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#edit-modal">
                                        <i class="fa fa-edit"></I>
                                    </button>
                                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#delete-modal">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr> -->

                    </tbody>
                </table>
            </div>

            <div class="modal fade" id="edit-modal" onload="preecherCamposForm()">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 style="color:#ffe602 ;" class="header" align="center"><b>Edit User</b></h4>
                        </div>
                        <div class="modal-body">
                            <form role="form" action="/edit_user">
                                <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
                                <div class="box-body">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Razao</label>
                                        <input id="input_razaoModal" type="text" class="form-control" name="username" placeholder="User name">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">CNPJ</label>
                                        <input id="cnpjModal" type="text" class="form-control" name="telefone" placeholder="Enter telefone">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Telefone</label>
                                        <input id="telModal" type="text" class="form-control" name="cargo" placeholder="Enter cargo">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Lougradouro</label>
                                        <input id="input_LougradouroModal" type="text" class="form-control" name="email" placeholder="Enter email">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Numero</label>
                                        <input id="input_numeroModal" type="text" class="form-control" name="change_password" placeholder="Enter password">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">UF</label>
                                        <input id="input_ufModal" type="text" class="form-control" name="change_password" placeholder="Enter password">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Cidade</label>
                                        <input id="input_cidadeModal" type="text" class="form-control" name="change_password" placeholder="Enter password">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                                    <button onclick="atualizar()" type="submit" class="btn btn-default btn-save">Save changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- right col -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            <div class="float-right d-none d-sm-block">

            </div>
            <strong>Copyright &copy;2022 <a href="../index.html">Eagle Totens</a>.</strong>
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <!-- AdminLTE App -->
    <script src="../dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="../dist/js/demo.js"></script>
    <!-- Page specific script -->

</body>
<script>
    buscar() //funcionando no local

    //deletar()

    // function deletar(cellId) {
    //     var idColaboradorVar = cellId;
    //     fetch("/colaboradores/deletar", {
    //         method: "DELETE",
    //         headers: {
    //             "Content-Type": "application/json"
    //         },
    //         body: JSON.stringify({
    //             idColaborador: idColaboradorVar,
    //         })
    //     }).then(function(resposta) {

    //         console.log("resposta: ", resposta);

    //         if (resposta.ok) {
    //             if (confirm('Deseja mesmo remover o colaborador?')) {
    //                 window.alert("Deletado com sucesso!");
    //                 window.location = "listaColaboradores.html";
    //             } else {
    //                 throw ("Houve um erro ao tentar realizar deletar colaborador!");
    //             }
    //         }



    //     }).catch(function(resposta) {
    //         console.log(`#ERRO: ${resposta}`);
    //         //finalizarAguardar();
    //     });
    // }


    function atualizar() {
        //nome,nivel_acesso,funcao,telefone,email,senha,fkEmpresa
        var nomeVar = input_nomeModal.value;
        var nivel_acessoVar = 1000;
        var funcaoVar = 'Gerente';
        var telefoneVar = '40028922';
        var emailVar = 'email';
        var senhaVar = 'senhaaaa';
        var idColaboradorVar = 1;

        fetch("/colaboradores/atualizar", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nome: nomeVar,
                telefone: telefoneVar,
                nivel_acesso: nivel_acessoVar,
                funcao: funcaoVar,
                email: emailVar,
                senha: senhaVar,
                idColaborador: idColaboradorVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Atualizado com sucesso!");
                //window.location = "cadastroColaborador.html";
                //                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar atualizar colaborador!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

    }

    function buscar() {
        var fkEmpresaVar = sessionStorage.FK_EMPRESA
        console.log(fkEmpresaVar);
        //inicio fetch
        fetch("/empresa/listar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkEmpresa: fkEmpresaVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Lista puxando com sucesso");
                resposta.json().then(json => {

                    console.log(json);
                    console.log(JSON.stringify(json));

                    var listaRazao = [];
                    var listaCnpj = [];
                    var listaTelefone = [];
                    var listaLogradouro = [];
                    var listaNumero = [];
                    var listaUf = [];
                    var listaCidade = [];
                    console.log(json.length);
                    for (var i = 0; i < json.length; i++) {
                        listaRazao.push(json[i].razao);
                        listaCnpj.push(json[i].cnpj);
                        listaTelefone.push(json[i].telefone);
                        listaLogradouro.push(json[i].logradouro);
                        listaNumero.push(json[i].numero);
                        listaUf.push(json[i].uf);
                        listaCidade.push(json[i].cidade);
                    }
                    for (var i = 0; i < json.length; i++) {
                        cadEmpresa(

                            listaRazao[i],
                            listaCnpj[i],
                            listaTelefone[i],
                            Listalogradouro[i],
                            listaNumero[i],
                            listaUf[i],
                            listaCidade[i]);
                    }


                });

            } else {
                throw ("Erro ao puxar lista");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });
        //fim fetch
    }




    $(document).ready(function() {
        /**
         * for showing edit item popup
         */

        $(document).on('click', "#edit-item", function() {
            $(this).addClass('edit-item-trigger-clicked'); //useful for identifying which trigger was clicked and consequently grab data from the correct row and not the wrong one.

            var options = {
                'backdrop': 'static'
            };
            $('#edit-modal').modal(options)
        })

        // on modal show
        $('#edit-modal').on('show.bs.modal', function() {
            var el = $(".edit-item-trigger-clicked"); // See how its usefull right here? 
            var row = el.closest(".data-row");

            // get the data
            var id = el.data('item-id');
            var name = row.children(".name").text();
            var description = row.children(".description").text();

            // fill the data in the input fields
            $("#modal-input-id").val(id);
            $("#modal-input-name").val(name);
            $("#modal-input-description").val(description);

        })

        // on modal hide
        $('#edit-modal').on('hide.bs.modal', function() {
            $('.edit-item-trigger-clicked').removeClass('edit-item-trigger-clicked')
            $("#edit-form").trigger("reset");
        })
    })

    var colab, index;

    function cadEmpresa(razao, cnpj, telefone, logradouro, numero, uf, cidade) {

        colab = document.getElementById("tbEmpresa");
        var qntlinhas = colab.rows.length
        var linha = colab.insertRow(qntlinhas);

        var cellRazao = linha.insertCell(0);
        var cellCnpj = linha.insertCell(1);
        var cellTelefone = linha.insertCell(2);
        var cellLogradouro = linha.insertCell(3);
        var cellNumero = linha.insertCell(4);
        var cellUf = linha.insertCell(5);
        var cellCidade = linha.insertCell(6);
        var callAcao = linha.insertCell(7);
        var cellId = linha.insertCell(8);

        cellRazao.innerHTML = razao;
        cellCnpj.innerHTML = cnpj;
        cellTelefone.innerHTML = telefone;
        cellLogradouro.innerHTML = logradouro;
        cellNumero.innerHTML = numero;
        cellUf.innerHTML = uf;
        cellCidade.innerHTML = cidade;
        callAcao.classList.add('btn-group');
        cellId.style = 'display: none';
        cellId.setAttribute('id', id_empresa);

        var div = document.createElement('div');
        div.classList.add('btn-group');
        callAcao.appendChild(div);


        var bt1 = document.createElement('button');
        div.appendChild(bt1);
        bt1.classList.add('btn-info');
        bt1.classList.add('btn');
        bt1.setAttribute('id', `btEdit${contador}`);
        bt1.setAttribute("onclick", `preencherCamposForm(${id_empresa})`)

        var imgEdit = document.createElement('i');
        bt1.appendChild(imgEdit);
        imgEdit.classList.add('fa-edit');
        imgEdit.classList.add('fa');

        var editar = document.getElementById(`btEdit${contador}`);
        editar.dataset.toggle = "modal";
        editar.dataset.target = "#edit-modal"

        var bt2 = document.createElement('button');
        callAcao.appendChild(div);
        div.appendChild(bt2);
        bt2.classList.add('btn-info');
        bt2.classList.add('btn');
        bt2.setAttribute('id', `btDel${contador}`);
        bt2.setAttribute("onclick", `deletar(${cellId.innerHTML})`);

        var imgDel = document.createElement('i');
        bt2.appendChild(imgDel);
        imgDel.classList.add('fa-trash');
        imgDel.classList.add('fa');

        var delet = document.getElementById(`btDel${contador}`);
        delet.dataset.toggle = "modal";
        delet.dataset.target = "#delet-modal"



        //limpar();
    }


    function preencherCamposForm(id_empresa) {
        var fkEmpresaVar = sessionStorage.FK_EMPRESA
        alert('ollá');
        fetch("/empresa/listar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkEmpresa: fkEmpresaVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Lista puxando com sucesso/preencher/");
                resposta.json().then(json => {

                    console.log(json);
                    console.log(JSON.stringify(json));

                    var razao;
                    var cnpj;
                    var telefone;
                    var logradouro;
                    var numero;
                    var uf;
                    var cidade;
                    console.log(json.length);
                    for (var i = 0; i < json.length; i++) {
                        if (json[i].id_empresa == id_empresa) {
                            razao = json[i].razao;
                            cnpj = json[i].cnpj;
                            telefone = json[i].telefone;
                            logradouro = json[i].logradouro;
                            numero = json[i].numero;
                            uf = json[i].uf;
                            cidade = json[i].cidade;

                        }
                    }
                    document.getElementById("input_razaoModal").value = nome;
                    document.getElementById("cnpjModal").value = telefone;
                    document.getElementById("telModal").value = funcao;
                    document.getElementById("input_LougradouroModal").value = email;
                    document.getElementById("input_ufModal").value = senha;
                    document.getElementById("input_cidadeModal").value = senha;



                });

            } else {
                throw ("Erro ao puxar lista");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });



    }

    /* function delColab(id) {

        if (confirm('Deseja mesmo remover empresa?')) {
            empresa = document.getElementById("tbEmpresa");
            var qntlinhas = empresa.rows.length;
            var linhaExcluida = id;
            linhaExcluida = deleteRow(qntlinhas);

        }


    }
 */

    function cadastrar() {
        //aguardar();

        var nomeVar = input_nome.value;
        var sobrenomeVar = input_sobrenome.value;
        var telefoneVar = tel.value;
        var nivel_acessoVar = lista_funcao.value;
        var emailVar = input_email.value;
        var senhaVar = input_senha.value;
        var funcaoVar = "";
        if (nivel_acessoVar == 1) {
            funcaoVar = "Manuteção";
        } else if (nivel_acessoVar == 2) {
            funcaoVar = "Gerente";
        } else {
            funcaoVar = "eagle totens";
        }
        nomeVar = nomeVar + " " + sobrenomeVar;

        fetch("/colaboradores/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nome: nomeVar,
                telefone: telefoneVar,
                nivel_acesso: nivel_acessoVar,
                funcao: funcaoVar,
                email: emailVar,
                senha: senhaVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Cadastro realizado com sucesso!");
                window.location = "cadastroColaborador.html";
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });
        limpar();
    }
</script>
<script>
    var fkEmpresa;
    //buscar();
    //atualizar();
    // desativar();

    function buscar() {
        console.log();
        //inicio fetch
        fetch("/empresa/listar", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Lista puxando com sucesso");
                resposta.json().then(json => {

                    console.log(json);
                    console.log(JSON.stringify(json));
                });

            } else {
                throw ("Erro ao puxar lista");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });
        //fim fetch
    }

    function atualizar() {
        //nome,nivel_acesso,funcao,telefone,email,senha,fkEmpresa
        var razao_socialVar = "Rua dos pratos";
        var cnpjVar = "9129481324";
        var telefoneVar = "40028922";
        var id_empresaVar = 3;

        fetch("/empresa/atualizar", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                razao_social: razao_socialVar,
                cnpj: cnpjVar,
                telefone: telefoneVar,
                id_empresa: id_empresaVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Atualizado com sucesso!");
                //window.location = "cadastroColaborador.html";
                //                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar atualizar colaborador!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

    }

    function desativar() {
        var statusVar = "inativo";
        var id_empresaVar = 3;
        fetch("/empresa/desativar", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                status: statusVar,
                id_empresa: id_empresaVar
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Desativado com sucesso!");
                //window.location = "cadastroColaborador.html";
                //                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar desativar empresa!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });

    }

    function cadastrar() {
        //aguardar();

        var razaoSocialVar = razao_social_input.value;
        var cnpjVar = cnpj_input.value;
        var telefoneVar = telefone_input.value;
        fetch("/empresa/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                razaoSocial: razaoSocialVar,
                cnpj: cnpjVar,
                telefone: telefoneVar,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                buscarFk(cnpjVar);
                /* 
                   window.alert("Cadastro realizado com sucesso!");
                   window.location = "cadastroEmpresa.html";
                */
                //inalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });
    }



    function buscarFk(cnpj) {
        var cnpjVar = cnpj
        fetch("/empresa/buscarFk", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                cnpj: cnpjVar,
            })
        }).then(function(resposta) {
            console.log("estou dentro do buscarFk!")

            if (resposta.ok) {
                console.log(resposta);
                resposta.json().then(json => {
                    fkEmpresa = json.id_empresa;
                    cadastrarEndereco(fkEmpresa)
                        /*  
                        var listaCadastradosId [] = json.id_empresa;
                        listaCadastradosId [0] = 1; 
                        listaCadastradosId [1] = 2;
                        listaNome[0] = torok
                        listaNome[1]
                        setTimeout(function() {
                            if (sessionStorage.NIVEL_ACESSO == 1) {
                                window.location = "./Dash/dashSuporte/indexSuporte.html";
                            } else if (sessionStorage.NIVEL_ACESSO == 2 || sessionStorage.NIVEL_ACESSO == 3) {
                                window.location = "./Dash/dashGerente/indexGerente.html";
                            }
                        }, 1000); // apenas para exibir o loading
                        */
                });

            } else {
                alert("Houve um erro ao tentar buscar fk");
                console.log("Houve um erro ao tentar  buscar fk!");

                resposta.text().then(texto => {
                    console.error(texto);
                    //           finalizarAguardar(texto);
                });
            }

        }).catch(function(erro) {
            console.log(erro);
        })
    }

    function cadastrarEndereco(fk_empresa) {
        var logradouroVar = logradouro_input.value;
        var ufVar = lista_uf.value;
        var cidadeVar = lista_cidade.value;
        var numeroVar = numero_input.value
        var fk_empresa = fk_empresa
        fetch("/empresa/cadastrarEndereco", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                logradouro: logradouroVar,
                uf: ufVar,
                cidade: cidadeVar,
                fk_empresa: fk_empresa,
                numero: numeroVar
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);


            if (resposta.ok) {

                window.alert("Cadastro realizado com sucesso!");
                setTimeout(function() {
                    window.location.reload();
                }, 2000);

                //inalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro endereco!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
            //finalizarAguardar();
        });
    }
</script>

</html>